<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>demo index</title>
</head>
<body>
<h2>local(My ID : <span id="my-id"></span>)</h2>
<hr/>
<button onclick="open_my_video()">open my video</button>
<button onclick="close_my_video()">close my video</button>
<button id="document.getElementById("capture_my_image_btn")" style="display: none;" onclick="capture_my_image()">capture image</button>
<div >
    <span id="my-video"></span>
    <span id="my-image"></span>
</div>
<h2>remote</h2>
<hr/>
<button onclick="">connect to others video</button>
<h2>client list</h2>
<ul id="client-list" >

</ul>
<div id="others-video">
    <span id="p2p_remote_video"></span>
</div>

</body>
</html>
<script src="../client/lz.rtc.client_config.js"></script>
<script src="../client/lz.rtc.Channel.js"></script>
<script src="../client/lz.rtc.peerManager.js"></script>

<script>

    var channel = new lz.rtc.Channel({
        socket:{
            url:"ws:localhost:4080"
        }
    });
    var peerManager = lz.rtc.peerManager;
    peerManager(channel,{
        on_remote_stream_coming:on_remote_stream_coming
    });
    channel.on_my_id_coming = function(message){
        document.getElementById("my-id").innerHTML = message.body.your_id;
    };

    channel.on_id_list_coming = function(msg){
        document.getElementById("client-list").innerHTML = "";
        msg.body.client_ids.forEach(function(ele){
            document.getElementById("client-list").innerHTML+=
                    "<li><a href='javascript:void(0);' onclick='channel.view_remote_video(\""+ ele +"\")'>"+ ele +"</a></li>";
        })
    };
    channel.on_new_client_want_to_view_my_video = function(msg){
        lz.rtc.peerManager.allow_remote_view(msg.body.remote_id);
    };



//    channel.on_new_client_want_to_view_my_video = function(msg){
//        console.log("on_new_client_want_to_view_my_video");
//        var p2p = new lz.rtc.peerManager({remote_id:msg.body.remote_id});
//        p2p.allow_remote_view_video(msg.body.remote_id);
//        p2p.on_remote_stream_coming = function(remote_id,stream){
//            console.log("on add stream!");
//            var remote_video = document.createElement('video');
//            remote_video.src = window.URL.createObjectURL(stream);
//            document.getElementById("p2p_remote_video").appendChild(remote_video);
//        };
//    };





    function on_remote_stream_coming(remote_id,stream){
        console.log("on add stream!");
        var remote_video = document.createElement('video');
        remote_video.autoplay = true;
        remote_video.src = window.URL.createObjectURL(stream);
        document.getElementById("p2p_remote_video").appendChild(remote_video);
    };








</script>
<!--<script src="./demo.js"></script>-->
